<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inventory</title>
    <style>
        :root { --primary: #007AFF; --danger: #FF3B30; --bg: #f2f2f7; --card: #ffffff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: #1c1c1e; }
        .hidden { display: none !important; }
        header { 
            padding: 15px; display: flex; justify-content: space-between; align-items: center; 
            background: var(--card); border-bottom: 1px solid #d1d1d6; position: sticky; top: 0; z-index: 100;
        }
        .container { padding: 15px; padding-bottom: 100px; }
        .card { 
            background: var(--card); border-radius: 12px; margin-bottom: 12px; 
            display: flex; align-items: center; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .card-img { width: 85px; height: 85px; background-size: cover; background-position: center; flex-shrink: 0; background-color: #eee; }
        .card-info { flex: 1; padding: 12px; font-weight: 600; font-size: 17px; }
        .controls { display: flex; flex-direction: column; gap: 4px; padding: 8px; background: #fafafa; border-left: 1px solid #eee; }
        .btn-mini { border: none; background: #eee; border-radius: 6px; padding: 6px 10px; font-size: 12px; cursor: pointer; }
        .btn-del { color: var(--danger); font-weight: bold; }
        .modal-bg { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index: 1000; }
        .modal-bg.active { display: flex; }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
        .fab { position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 4px 15px rgba(0,122,255,0.4); z-index: 99; }
    </style>
</head>
<body>

<header>
    <button id="back-btn" class="btn-mini hidden" onclick="goBack()">‚Üê Back</button>
    <h2 id="title">Locations</h2>
    <div style="width:40px"></div>
</header>

<div class="container" id="app-content"></div>

<button class="fab" id="main-fab" onclick="openModal('folder-modal')">+</button>

<div id="folder-modal" class="modal-bg">
    <div class="modal">
        <h3>New Location</h3>
        <input id="f-name" placeholder="Location Name">
        <input id="f-img" placeholder="Image URL">
        <button class="btn-mini" style="background:var(--primary); color:white; width:100%; padding:15px; font-size:16px;" onclick="saveFolder()">Create Location</button>
        <button class="btn-mini" style="width:100%; margin-top:10px; padding:10px;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<div id="item-modal" class="modal-bg">
    <div class="modal">
        <h3>Add New Item</h3>
        <input id="i-name" placeholder="Item Name">
        <input id="i-img" placeholder="Image URL">
        <button class="btn-mini" style="background:var(--primary); color:white; width:100%; padding:15px; font-size:16px;" onclick="saveItem()">Add to Inventory</button>
        <button class="btn-mini" style="width:100%; margin-top:10px; padding:10px;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC2sZwT7PeKJHW9LJ4_xdxKMMVxZMrllWg",
        authDomain: "inventory-8a01f.firebaseapp.com",
        databaseURL: "https://inventory-8a01f-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "inventory-8a01f",
        storageBucket: "inventory-8a01f.firebasestorage.app",
        messagingSenderId: "759088447580",
        appId: "1:759088447580:web:5859088803734d62c2e699"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const invRef = ref(db, 'inventory/');

    let state = { folders: [] };
    let currentFolderId = null;

    onValue(invRef, (snap) => {
        const data = snap.val();
        state = data || { folders: [] };
        render();
    });

    function sync() { set(invRef, state); }

    window.render = () => {
        const content = document.getElementById('app-content');
        const backBtn = document.getElementById('back-btn');
        const fab = document.getElementById('main-fab');
        content.innerHTML = '';

        if (currentFolderId === null) {
            backBtn.classList.add('hidden');
            fab.classList.remove('hidden');
            document.getElementById('title').innerText = "Locations";
            
            state.folders.forEach((f, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-img" style="background-image:url('${f.img || ''}')" onclick="openFolder(${f.id})"></div>
                    <div class="card-info" onclick="openFolder(${f.id})">${f.name}</div>
                    <div class="controls">
                        <button class="btn-mini" onclick="move('f', ${idx}, -1)">‚ñ≤</button>
                        <button class="btn-mini" onclick="move('f', ${idx}, 1)">‚ñº</button>
                        <button class="btn-mini btn-del" onclick="deleteObj('f', ${idx})">üóëÔ∏è</button>
                    </div>`;
                content.appendChild(card);
            });
        } else {
            backBtn.classList.remove('hidden');
            fab.classList.add('hidden');
            const folder = state.folders.find(f => f.id === currentFolderId);
            document.getElementById('title').innerText = folder.name;
            
            const addBtn = document.createElement('button');
            addBtn.className = 'btn-mini';
            addBtn.style = "width:100%; margin-bottom:15px; background:white; height:50px; font-weight:bold; border: 2px dashed #ccc;";
            addBtn.innerText = "+ Add Item Here";
            addBtn.onclick = () => openModal('item-modal');
            content.appendChild(addBtn);

            (folder.items || []).forEach((item, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-img" style="background-image:url('${item.img || ''}')"></div>
                    <div class="card-info">${item.name}</div>
                    <div class="controls">
                        <button class="btn-mini" onclick="move('i', ${idx}, -1)">‚ñ≤</button>
                        <button class="btn-mini" onclick="move('i', ${idx}, 1)">‚ñº</button>
                        <button class="btn-mini btn-del" onclick="deleteObj('i', ${idx})">üóëÔ∏è</button>
                    </div>`;
                content.appendChild(card);
            });
        }
    };

    window.openFolder = (id) => { currentFolderId = id; render(); };
    window.goBack = () => { currentFolderId = null; render(); };
    window.openModal = (id) => { document.getElementById(id).classList.add('active'); };
    window.closeModals = () => { document.querySelectorAll('.modal-bg').forEach(m => m.classList.remove('active')); };

    window.saveFolder = () => {
        const name = document.getElementById('f-name').value;
        const img = document.getElementById('f-img').value;
        if (!name) return;
        state.folders.push({ id: Date.now(), name, img, items: [] });
        sync(); 
        document.getElementById('f-name').value = '';
        document.getElementById('f-img').value = '';
        closeModals();
    };

    window.saveItem = () => {
        const name = document.getElementById('i-name').value;
        const img = document.getElementById('i-img').value;
        if (!name) return;
        const f = state.folders.find(f => f.id === currentFolderId);
        if (!f.items) f.items = [];
        f.items.push({ id: Date.now(), name, img });
        sync();
        document.getElementById('i-name').value = '';
        document.getElementById('i-img').value = '';
        closeModals();
    };

    window.deleteObj = (type, idx) => {
        if (!confirm("Delete this permanently?")) return;
        if (type === 'f') {
            state.folders.splice(idx, 1);
        } else {
            const f = state.folders.find(f => f.id === currentFolderId);
            f.items.splice(idx, 1);
        }
        sync();
    };

    window.move = (type, idx, dir) => {
        let list = type === 'f' ? state.folders : state.folders.find(f => f.id === currentFolderId).items;
        let newIdx = idx + dir;
        if (newIdx < 0 || newIdx >= list.length) return;
        [list[idx], list[newIdx]] = [list[newIdx], list[idx]];
        sync();
    };
</script>
</body>
</html>
