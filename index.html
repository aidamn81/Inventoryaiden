<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visual Inventory Manager</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --danger-color: #FF3B30;
            --text-dark: #1C1C1E;
            --bg-card: rgba(255, 255, 255, 0.95);
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --radius: 12px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #000000; background-size: cover; background-position: center;
            color: var(--text-dark); height: 100vh; overflow: hidden;
        }
        .hidden { display: none !important; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: var(--radius); font-size: 16px; margin-bottom: 10px; }
        .btn { border: none; padding: 12px 20px; border-radius: var(--radius); font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: rgba(0,0,0,0.05); color: var(--text-dark); }
        
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: var(--bg-card); height: 60px; }
        #btn-back { display: none; background: #eee; border: none; padding: 8px 15px; border-radius: 20px; }
        
        .view-content { flex: 1; overflow-y: auto; padding: 20px; height: calc(100vh - 60px); }
        .main-folder-card { display: flex; background: var(--bg-card); border-radius: var(--radius); margin-bottom: 15px; overflow: hidden; height: 100px; box-shadow: var(--shadow); }
        .main-folder-img { width: 100px; background-size: cover; background-position: center; }
        .main-folder-info { flex: 1; padding: 15px; display: flex; flex-direction: column; justify-content: center; }
        
        .toolbar { display: flex; gap: 10px; margin-bottom: 20px; }
        .subfolder-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .sub-card { background: white; aspect-ratio: 1; border-radius: 10px; overflow: hidden; position: relative; border: 1px solid #eee; }
        .sub-card img { width: 100%; height: 100%; object-fit: cover; }
        
        .item-card { display: flex; background: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; align-items: center; box-shadow: var(--shadow); }
        .item-thumb { width: 60px; height: 60px; background-size: contain; background-repeat: no-repeat; background-position: center; margin-right: 15px; background-color: #f9f9f9; border-radius: 5px; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; }
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary-color); color: white; border-radius: 50%; border: none; font-size: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <header>
        <button id="btn-back" onclick="goBack()">‚Üê Back</button>
        <h1 id="page-title">WHERE THE FUCK ARE MY THINGS</h1>
        <div style="width:40px"></div>
    </header>

    <main id="view-dashboard" class="view-content">
        <div id="main-container"></div>
    </main>

    <main id="view-folder" class="view-content hidden">
        <div class="toolbar">
            <button class="btn btn-primary" style="flex:2" onclick="openModal('modal-item')">+ Item</button>
            <button class="btn btn-secondary" style="flex:1" onclick="openModal('modal-sub')">+ Sub</button>
        </div>
        <div id="sub-grid" class="subfolder-grid"></div>
        <div id="item-list"></div>
    </main>

    <button id="fab-add" class="fab" onclick="openModal('modal-main')">+</button>

    <div id="modal-main" class="modal-overlay"><div class="modal"><h3>New Location</h3><input id="in-m-name" placeholder="Name"><input id="in-m-img" placeholder="Image URL"><button class="btn btn-primary" onclick="addMain()">Create</button><button class="btn" onclick="closeModal('modal-main')">Cancel</button></div></div>
    <div id="modal-sub" class="modal-overlay"><div class="modal"><h3>New Sub-Folder</h3><input id="in-s-name" placeholder="Name"><input id="in-s-img" placeholder="Image URL"><button class="btn btn-primary" onclick="addSub()">Create</button><button class="btn" onclick="closeModal('modal-sub')">Cancel</button></div></div>
    <div id="modal-item" class="modal-overlay"><div class="modal"><h3>New Item</h3><input id="in-i-name" placeholder="Item Name"><input id="in-i-img" placeholder="Image URL"><button class="btn btn-primary" onclick="addItem()">Save</button><button class="btn" onclick="closeModal('modal-item')">Cancel</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Your Firebase config (Linked to your project)
        const firebaseConfig = {
          apiKey: "AIzaSyC2sZwT7PeKJHW9LJ4_xdxKMMVxZMrllWg",
          authDomain: "inventory-8a01f.firebaseapp.com",
          databaseURL: "https://inventory-8a01f-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "inventory-8a01f",
          storageBucket: "inventory-8a01f.firebasestorage.app",
          messagingSenderId: "759088447580",
          appId: "1:759088447580:web:5859088803734d62c2e699"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const invRef = ref(db, 'inventory/');

        let appState = { folders: [] };
        let currentFolderId = null;

        // --- Sync Data ---
        onValue(invRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                appState = data;
                currentFolderId ? renderFolder(currentFolderId) : renderIndex();
            }
        });

        function save() { set(invRef, appState); }

        // --- Logic ---
        window.renderIndex = function() {
            navigateTo('dashboard');
            const container = document.getElementById('main-container');
            container.innerHTML = '';
            (appState.folders || []).forEach(f => {
                const div = document.createElement('div');
                div.className = 'main-folder-card';
                div.onclick = () => renderFolder(f.id);
                div.innerHTML = `<div class="main-folder-img" style="background-image:url('${f.img || ''}')"></div><div class="main-folder-info"><b>${f.name}</b></div>`;
                container.appendChild(div);
            });
        }

        window.renderFolder = function(id) {
            currentFolderId = id;
            navigateTo('folder');
            const f = appState.folders.find(x => x.id === id);
            document.getElementById('page-title').innerText = f.name;
            
            const subGrid = document.getElementById('sub-grid');
            subGrid.innerHTML = '';
            (f.subs || []).forEach(s => {
                const sd = document.createElement('div');
                sd.className = 'sub-card';
                sd.innerHTML = `<img src="${s.img || ''}"><div style="position:absolute;bottom:0;width:100%;background:rgba(0,0,0,0.6);color:white;font-size:10px;text-align:center">${s.name}</div>`;
                subGrid.appendChild(sd);
            });

            const list = document.getElementById('item-list');
            list.innerHTML = '';
            (f.items || []).forEach(i => {
                const idiv = document.createElement('div');
                idiv.className = 'item-card';
                idiv.innerHTML = `<div class="item-thumb" style="background-image:url('${i.img || ''}')"></div><div><b>${i.name}</b></div>`;
                list.appendChild(idiv);
            });
        }

        window.addMain = () => {
            const name = document.getElementById('in-m-name').value;
            if(!appState.folders) appState.folders = [];
            appState.folders.push({ id: Date.now(), name, img: document.getElementById('in-m-img').value, items: [], subs: [] });
            save(); closeModal('modal-main');
        }

        window.addItem = () => {
            const f = appState.folders.find(x => x.id === currentFolderId);
            if(!f.items) f.items = [];
            f.items.push({ id: Date.now(), name: document.getElementById('in-i-name').value, img: document.getElementById('in-i-img').value });
            save(); closeModal('modal-item');
        }

        window.addSub = () => {
            const f = appState.folders.find(x => x.id === currentFolderId);
            if(!f.subs) f.subs = [];
            f.subs.push({ id: Date.now(), name: document.getElementById('in-s-name').value, img: document.getElementById('in-s-img').value, items: [] });
            save(); closeModal('modal-sub');
        }

        window.navigateTo = (v) => {
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-folder').classList.add('hidden');
            document.getElementById('btn-back').style.display = (v === 'dashboard' ? 'none' : 'block');
            document.getElementById('fab-add').style.display = (v === 'dashboard' ? 'block' : 'none');
            document.getElementById('view-' + v).classList.remove('hidden');
            if(v === 'dashboard') { document.getElementById('page-title').innerText = "Index"; currentFolderId = null; }
        }

        window.goBack = () => renderIndex();
        window.openModal = (id) => document.getElementById(id).classList.add('active');
        window.closeModal = (id) => document.getElementById(id).classList.remove('active');

        renderIndex();
    </script>
</body>
</html>
